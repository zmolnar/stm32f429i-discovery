/* thrPressureReader.c --- 
 * 
 * @file thrPressureReader.c
 * @brief Read pressure data from MS5611 barometric pressure sensor.
 * @author Moln치r Zolt치n
 * @date Sun Nov 22 13:17:39 2015 (+0100)
 * Version: 1.0.0
 * Last-Updated: Sun Nov 22 15:12:12 2015 (+0100)
 *           By: Moln치r Zolt치n
 * 
 */

/*******************************************************************************/
/* INCLUDES                                                                    */
/*******************************************************************************/
#include "thrPressureReader.h"
#include "ms5611.h"

/*******************************************************************************/
/* DEFINED CONSTANTS                                                           */
/*******************************************************************************/


/*******************************************************************************/
/* MACRO DEFINITIONS                                                           */
/*******************************************************************************/


/*******************************************************************************/
/* TYPE DEFINITIONS                                                            */
/*******************************************************************************/
extern Thread *psignalprocessor;

/*******************************************************************************/
/* DEFINITION OF GLOBAL CONSTANTS AND VARIABLES                                */
/*******************************************************************************/


/*******************************************************************************/
/* DEFINITION OF LOCAL FUNCTIONS                                               */
/*******************************************************************************/


/*******************************************************************************/
/* DEFINITION OF GLOBAL FUNCTIONS                                              */
/*******************************************************************************/
msg_t ThrPressureReader (void *arg) {
        (void)arg;
        chRegSetThreadName("PressureReader");   
        
        MS5611_Init ();
        MS5611_Reset ();
        
        while (1) {
                struct PressureData_s data = {0};

                MS5611_Measure (&data.p_raw, &data.t_raw);
                data.t = chTimeNow();
                chMsgSend (psignalprocessor, (msg_t)&data);
        }
}


/******************************* END OF FILE ***********************************/

